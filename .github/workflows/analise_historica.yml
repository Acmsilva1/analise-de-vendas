name: Geraﾃｧﾃ｣o de Dashboard Histﾃｳrico Mensal

# 1. QUANDO RODAR (GATILHO)
on:
  schedule:
    # Roda no primeiro dia de cada mﾃｪs, ﾃs 03:00 UTC (Meia-noite BRT)
    - cron: '0 3 1 * *' 
  
  # Permite que vocﾃｪ o acione manualmente para testes
  workflow_dispatch:

# 2. OS TRABALHOS (JOB)
jobs:
  run_monthly_historical_analysis:
    
    # 圷 CORREﾃﾃグ 1: ADICIONAR PERMISSﾃグ DE ESCRITA PARA O COMMIT
    permissions:
      contents: write 
    
    runs-on: ubuntu-latest

    steps:
      - name: 逃 Checkout Cﾃｳdigo
        uses: actions/checkout@v4

      # 錐 Configuraﾃｧﾃ｣o do ambiente Python e Instalaﾃｧﾃ｣o de dependﾃｪncias
      - name: Set up Python e Instalar Dependﾃｪncias
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' 
      
      - name: Instalar gspread e PANDAS (requirements.txt)
        # Requer que 'gspread' e 'pandas' estejam no seu requirements.txt
        run: pip install -r requirements.txt

      # 柏 Cria o Arquivo de Credenciais
      - name: Criar Arquivo de Credenciais
        run: echo '${{ secrets.GOOGLE_CREDENTIALS }}' > credenciais.json

      # 噫 EXECUﾃﾃグ DO SCRIPT DE ANﾃ´ISE HISTﾃ迭ICA
      - name: Executar Anﾃ｡lise Histﾃｳrica e Gerar HTML
        run: python analise_historica.py
        
      # 沈 PUBLICAﾃﾃグ DO NOVO DASHBOARD HTML
      - name: Commit do Dashboard Histﾃｳrico Atualizado
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Feat: Dashboard Histﾃｳrico e Tendﾃｪncias atualizado (Mensal)"
          # 笨 CORREﾃﾃグ 2: USAR file_pattern NO LUGAR DE files
          file_pattern: dashboard_historico.html
