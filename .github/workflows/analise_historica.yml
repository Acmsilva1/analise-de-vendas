name: Geraﾃｧﾃ｣o de Dashboard Histﾃｳrico Mensal

# 1. QUANDO RODAR (GATILHO)
on:
  schedule:
    # Roda no primeiro dia de cada mﾃｪs, ﾃs 03:00 UTC (Meia-noite BRT)
    - cron: '0 3 1 * *' 
  
  # Permite que vocﾃｪ o acione manualmente para testes
  workflow_dispatch:

# 2. OS TRABALHOS (JOB)
jobs:
  run_monthly_historical_analysis:
    
    # PERMISSﾃグ DE ESCRITA: Corrigiu o erro 403
    permissions:
      contents: write 
    
    runs-on: ubuntu-latest

    steps:
      - name: 逃 Checkout Cﾃｳdigo
        uses: actions/checkout@v4

      # 錐 Configuraﾃｧﾃ｣o do ambiente Python e Instalaﾃｧﾃ｣o de dependﾃｪncias
      - name: Set up Python e Instalar Dependﾃｪncias
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' 
      
      - name: Instalar gspread e PANDAS (requirements.txt)
        run: pip install -r requirements.txt

      # 柏 CRIA O ARQUIVO DE CREDENCIAIS (INJEﾃﾃグ DIRETA COM ASPAS DUPLAS)
      - name: Criar Arquivo de Credenciais
        # Removemos a variﾃ｡vel ENV e passamos o Secret diretamente.
        # As aspas duplas ("") garantem a correta expansﾃ｣o no shell.
        run: echo "${{ secrets.GOOGLE_CREDENTIALS }}" > credenciais.json
        
      # 噫 EXECUﾃﾃグ DO SCRIPT DE ANﾃ´ISE HISTﾃ迭ICA
      - name: Executar Anﾃ｡lise Histﾃｳrica e Gerar HTML
        run: python analise_historica.py
        
      # 沈 PUBLICAﾃﾃグ DO NOVO DASHBOARD HTML
      - name: Commit do Dashboard Histﾃｳrico Atualizado
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Feat: Dashboard Histﾃｳrico e Tendﾃｪncias atualizado (Mensal)"
          file_pattern: dashboard_historico.html
