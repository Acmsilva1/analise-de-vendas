name: GeraÃ§Ã£o de Dashboard HistÃ³rico Mensal

# 1. QUANDO RODAR (GATILHO)
on:
  schedule:
    # Roda no primeiro dia de cada mÃªs, Ã s 03:00 UTC.
    # Isso Ã© 00:00 (meia-noite) no horÃ¡rio de BrasÃ­lia, garantindo que rode
    # logo apÃ³s a conclusÃ£o do backup mensal (que roda Ã s 00:00 UTC).
    - cron: '0 3 1 * *' 
  
  # Permite que vocÃª o acione manualmente para testes
  workflow_dispatch:

# 2. OS TRABALHOS (JOB)
jobs:
  run_monthly_historical_analysis:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ Checkout CÃ³digo
        uses: actions/checkout@v4

      # ğŸ ConfiguraÃ§Ã£o do ambiente Python e InstalaÃ§Ã£o de dependÃªncias
      - name: Set up Python e Instalar DependÃªncias
        uses: actions/setup-python@v5
        with:
          python-version: '3.x' 
      
      - name: Instalar gspread e PANDAS (requirements.txt)
        # Requer que 'gspread' e 'pandas' estejam no seu requirements.txt
        run: pip install -r requirements.txt

      # ğŸ” Cria o Arquivo de Credenciais (Requer o Secret GOOGLE_CREDENTIALS)
      - name: Criar Arquivo de Credenciais
        # Gera o arquivo 'credenciais.json' que o script Python vai ler
        run: echo '${{ secrets.GOOGLE_CREDENTIALS }}' > credenciais.json

      # ğŸš€ EXECUÃ‡ÃƒO DO SCRIPT DE ANÃLISE HISTÃ“RICA
      - name: Executar AnÃ¡lise HistÃ³rica e Gerar HTML
        run: python analise_historica.py
        
      # ğŸ’¾ PUBLICAÃ‡ÃƒO DO NOVO DASHBOARD HTML
      # Esta etapa Ã© crucial para que as alteraÃ§Ãµes no HTML sejam salvas no repositÃ³rio
      - name: Commit do Dashboard HistÃ³rico Atualizado
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # Salva o arquivo HTML gerado pelo script Python
          files: dashboard_historico.html
          commit_message: "Feat: Dashboard HistÃ³rico e TendÃªncias atualizado (Mensal)"
