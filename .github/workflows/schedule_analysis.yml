name: Dashboard de Vendas - AutomaÃ§Ã£o DiÃ¡ria

# 1. QUANDO RODAR
on:
  schedule:
    # Roda Ã s 11:00 UTC (8h do Brasil) e 23:00 UTC (20h do Brasil)
    - cron: '0 11,23 * * *'
  
  # ğŸš¨ CORREÃ‡ÃƒO: ADICIONE ESTE BLOCO PARA O BOTÃƒO MANUAL
  workflow_dispatch: 
  
  # Se quiser rodar a cada push no main, adicione o bloco abaixo
  # push:
  #   branches:
  #     - main 

# 2. O QUE FAZER
jobs:
  run_analysis:
    # ğŸš¨ ESTAS SÃƒO AS LINHAS CRÃTICAS PARA CORRIGIR O ERRO 403
    permissions:
      contents: write 
    
    runs-on: ubuntu-latest
    
    steps:
      - name: â¬‡ï¸ Checkout do CÃ³digo
        uses: actions/checkout@v4
        
      - name: ğŸ Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          
      - name: âš™ï¸ Instalar DependÃªncias
        run: |
          pip install pandas plotly gspread
          
      - name: ğŸƒ Rodar AnÃ¡lise de Vendas
        env:
          GCP_SA_CREDENTIALS: ${{ secrets.GCP_SA_CREDENTIALS }}
        run: python analise_vendas_automacao.py
        
      # 2.5. Commit e Push do novo dashboard HTML
      - name: ğŸ’¾ Commit do Dashboard Atualizado
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'ci: ğŸ“ˆ Dashboard de vendas atualizado via automaÃ§Ã£o'
          # CORRIGE O 'Warning: Unexpected input(s) files'
          file_pattern: 'dashboard_vendas_final.html' 
          skip_dirty_check: false
          
      - name: âœ… Sucesso!
        run: echo "AnÃ¡lise e commit finalizados!"
