name: Dashboard de Vendas - AutomaÃ§Ã£o DiÃ¡ria

# 1. QUANDO RODAR
on:
  # Agendamento: Roda todos os dias Ã  00:00 UTC (ajuste o cron se precisar de outro horÃ¡rio)
  schedule:
    - cron: '0 0 * * *'
  # Permite que vocÃª execute manualmente clicando em "Run workflow" no GitHub
  workflow_dispatch:

# 2. O QUE FAZER
jobs:
  run_analysis:
    # Rodar no sistema operacional Ubuntu (padrÃ£o Linux)
    runs-on: ubuntu-latest
    
    steps:
      # 2.1. Baixar o cÃ³digo do seu repositÃ³rio
      - name: â¬‡ï¸ Checkout do CÃ³digo
        uses: actions/checkout@v4
        # Para que o commit automÃ¡tico funcione, vocÃª precisa de um token de permissÃ£o
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      # 2.2. Configurar o ambiente Python
      - name: ğŸ Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          
      # 2.3. Instalar as dependÃªncias do seu script (gspread Ã© novo!)
      - name: âš™ï¸ Instalar DependÃªncias
        run: |
          pip install pandas plotly gspread
          
      # 2.4. Executar o Script Python
      - name: ğŸƒ Rodar AnÃ¡lise de Vendas
        # O Secret Ã© passado aqui, onde o script Python o lerÃ¡ via os.environ.get()
        env:
          GCP_SA_CREDENTIALS: ${{ secrets.GCP_SA_CREDENTIALS }}
        run: python analise_vendas_automacao.py
        
      # 2.5. Commit e Push do novo dashboard HTML
      - name: ğŸ’¾ Commit do Dashboard Atualizado
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'ci: ğŸ“ˆ Dashboard de vendas atualizado via automaÃ§Ã£o'
          # Diz ao Git para versionar apenas o arquivo HTML gerado
          files: 'dashboard_vendas_final.html'
          # Se o arquivo nÃ£o mudou, nÃ£o faz o commit
          skip_dirty_check: false
          
      - name: âœ… Sucesso!
        run: echo "AnÃ¡lise e commit finalizados!"
