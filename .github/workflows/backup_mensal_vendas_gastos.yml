name: BACKUP DE VENDAS E GASTOS

on:
  # 1. Gatilho Manual (Adicionamos um input opcional)
  workflow_dispatch:
    inputs:
      force_run:
        description: 'Forçar execução manual (ignora verificação de data 1 e 16)?'
        required: false
        default: 'false'
        type: boolean

  # 2. Gatilhos Agendados (Inalterados, continuam nos dias 1 e 16)
  schedule:
    - cron: '1 0 1 * *' 
    - cron: '1 0 16 * *'

jobs:
  run_consolidation:
    runs-on: ubuntu-latest
    steps:
      # ... (Steps 1, 2 e 3 permanecem inalterados) ...
      
      - name: 4. Executar o Script do Agente de Backup
        run: python backup_gastos_despesas_mensal.py
        env:
          # Mapeamento do Secret (Inalterado)
          GSPREAD_SERVICE_ACCOUNT_CREDENTIALS: ${{ secrets.GCP_SA_CREDENTIALS }}
          
          # NOVO: Definir a variável de Forçar Execução Manual
          # Esta variável só será 'true' se o workflow_dispatch for usado E o input 'force_run' for marcado/true.
          # Se vier do schedule, este input não existe, e a variável será indefinida (false/vazia).
          FORCA_EXECUCAO_MANUAL: ${{ github.event.inputs.force_run }}
